<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name = "viewport" content = "width=device-width, initial-scale = 1, maximum-scale = 1.0, user-scalable = 0">
    <link rel = "stylesheet" href = "style.css">
    <link rel = "stylesheet" href = "../../styles/reset.css">
    <link rel = "stylesheet" href = "../../styles/common.css">
    <link rel = "stylesheet" href = "../../styles/font.css">
    <link rel = "stylesheet" href = "../../styles/colors.css">
    <title>Information page</title>

    <script>
        async function loadImageFromServer() {
            const url = 'http://localhost:3000/api/image';

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status}`);
                }

                const data = await response.json();

                // Создаём элемент изображения
                const img = document.createElement('img');
                img.src = `http://localhost:3000${data.imageUrl}`;
                img.alt = 'Загруженное изображение';
                img.classList.add('loaded-image');

                // Добавляем изображение в контейнер
                const container = document.getElementById('image-container');
                container.innerHTML = ''; // Очищаем контейнер перед добавлением нового изображения
                container.appendChild(img);

            } catch (error) {
                alert(`Произошла ошибка при загрузке изображения: ${error.message}`);
            }
        }
    </script>

    <script>
        async function uploadDataToServer(){
            // Получаем значения из полей формы, приводим к нижнему регистру для удобства проверки
            const text = document.getElementById('text').value.trim().toLowerCase();
            const message = document.getElementById('message').value.trim();

            // Проверяем, что пользователь ввел "да" или "нет"
            if (text !== 'да' && text !== 'нет') {
                alert('Пожалуйста, введите только "да" или "нет" в поле "Вам понравился выбор мемов?"');
                return;
            }

            // Проверяем, что все поля заполнены
            if (!text || !message) {
                alert('Пожалуйста, заполните все поля формы');
                return;
            }

            const formData = {
                liked: text,
                comment: message
            };

            try {
                const response = await fetch('http://localhost:3000/api/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status}`);
                }

                alert(`Спасибо за ваш отзыв!`);

            } catch (error) {
                alert(`Произошла ошибка при отправке данных: ${error.message}`);
            }
        }
    </script>

</head>
<body>
<div class = "main-container">

    <div class = "form-container">
        <h2>Форма обратной мем-связи</h2>

        <div class = "form-group">
            <label for = "text">Вам понравился выбор мемов?</label>
            <input type = "text" id = "text" name = "text" placeholder = "Введите да или нет" required>
        </div>

        <div class = "form-group">
            <label for = "message">Комментарий по поводу мемов:</label>
            <textarea id = "message" name = "message" rows = "4" placeholder = "Ваш комментарий" required></textarea>
        </div>

        <button type = "button" class = "send-information-button" onclick = "uploadDataToServer()">Отправить</button>
    </div>

    <div class = "picture-container">
        <button class = "btn" onclick = "loadImageFromServer()">Хочу картинку</button>
        <div class = "image-container" id = "image-container">
        </div>
    </div>


    <div class = "boring-end-words">
        <a class = "boring-end-words-link" href = "../main_page/index.html">
            <p class = "boring-end-words-text">Ты все-таки решил выбрать, какой ты мем? Ура! НАЖМИ сюда!</p>
        </a>
    </div>

</div>
</body>
</html>